<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Simulador de Agujero Negro – Kerr Relativista Pro</title>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background: black;
        font-family: Consolas, monospace;
    }

    canvas { display: block; }

    #info {
        position: absolute;
        top: 20px;
        left: 20px;
        color: #fff;
        font-size: 12px;
        letter-spacing: 1px;
        background: rgba(10,10,30,0.8);
        padding: 15px;
        border-radius: 4px;
        border-left: 3px solid #ffcc00;
        backdrop-filter: blur(8px);
        pointer-events: none;
        text-transform: uppercase;
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }

    .val { color: #00e6e6; font-weight: bold; }
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div id="info">
    <strong>Simulador de Agujero Negro – Kerr</strong><br><br>
    FPS: <span id="fps" class="val">0</span><br>
    Partículas: <span id="activeParticles" class="val">0</span><br>
    Spin (a): <span class="val">0.99</span>
</div>

<script>
/* ==========================================================
   CONFIGURACIÓN DE CANVAS (HD REAL)
========================================================== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = innerWidth * dpr;
    canvas.height = innerHeight * dpr;
    canvas.style.width = innerWidth + "px";
    canvas.style.height = innerHeight + "px";
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
window.addEventListener("resize", resize);
resize();

/* ==========================================================
   CONSTANTES FÍSICAS (ESCALADAS)
========================================================== */
const G = 1, c = 1;
const M = 30;
const a = 0.99;
const scale = 6;

let rs, rPlus, rISCO, cx, cy;

function calculateMetrics() {
    cx = innerWidth / 2;
    cy = innerHeight / 2;
    rs = 2 * G * M;
    rPlus = G * M * (1 + Math.sqrt(1 - a * a));
    rISCO = rs * 2.5;
}
calculateMetrics();

/* ==========================================================
   ESTRELLAS DE FONDO (CANVAS ESTÁTICO)
========================================================== */
const stars = Array.from({ length: 400 }, () => ({
    x: Math.random() * innerWidth,
    y: Math.random() * innerHeight,
    r: Math.random() * 1.5,
    a: 0.2 + Math.random() * 0.6
}));

function drawStars() {
    for (const s of stars) {
        ctx.globalAlpha = s.a;
        ctx.fillStyle = "#fff";
        ctx.fillRect(s.x, s.y, s.r, s.r);
    }
    ctx.globalAlpha = 1;
}

/* ==========================================================
   PARTÍCULAS DEL DISCO DE ACRECIÓN
========================================================== */
class Particle {
    constructor() { this.reset(); }

    reset() {
        this.r = rISCO * 0.9 + Math.random() * rISCO * 6;
        this.theta = Math.random() * Math.PI * 2;
        this.size = 0.8 + Math.random() * 2.5;
        this.speed = (0.01 + Math.random() * 0.02) * Math.pow(rISCO / this.r, 1.7);
        this.updateTrig();
    }

    updateTrig() {
        this.sin = Math.sin(this.theta);
        this.cos = Math.cos(this.theta);
    }

    update() {
        this.theta += this.speed;
        this.r -= 0.003;
        this.updateTrig();

        if (this.r < rPlus * 0.85) this.reset();
    }

    draw() {
        const x = this.cos * this.r;
        const y = this.sin * this.r;

        // Lente gravitacional ~ 1/r²
        const lens = (rISCO * 12) / (this.r * this.r);

        const sx = cx + x * scale;
        const sy = cy + y * 0.25 * scale - lens * scale;

        // Doppler relativista (aprox)
        const doppler = 1 - this.sin * 0.35;

        let r = 255 * doppler;
        let g = (120 + 135 * (rISCO / this.r)) * doppler;
        let b = (80 + 160 * (rISCO / this.r)) * doppler;

        ctx.fillStyle = `rgb(${r|0},${g|0},${b|0})`;
        ctx.shadowBlur = this.size * 2;
        ctx.shadowColor = ctx.fillStyle;

        ctx.beginPath();
        ctx.arc(sx, sy, this.size, 0, Math.PI * 2);
        ctx.fill();

        ctx.shadowBlur = 0;
    }
}

/* ==========================================================
   CREACIÓN DE PARTÍCULAS
========================================================== */
const particles = [];
const NUM = 2500;
for (let i = 0; i < NUM; i++) {
    const p = new Particle();
    for (let j = 0; j < 30; j++) p.update(); // precalentado
    particles.push(p);
}

/* ==========================================================
   AGUJERO NEGRO CENTRAL
========================================================== */
function drawBlackHole() {
    ctx.shadowBlur = 100;
    ctx.shadowColor = "black";
    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(cx, cy, rPlus * scale * 0.8, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;

    ctx.strokeStyle = "rgba(255,255,255,0.12)";
    ctx.beginPath();
    ctx.arc(cx, cy, rPlus * scale * 1.1, 0, Math.PI * 2);
    ctx.stroke();
}

/* ==========================================================
   LOOP DE ANIMACIÓN
========================================================== */
let last = 0;
function animate(t) {
    const dt = (t - last) / 1000;
    last = t;

    ctx.fillStyle = "rgba(0,0,0,0.12)";
    ctx.fillRect(0, 0, innerWidth, innerHeight);

    drawStars();

    // Partículas traseras
    for (const p of particles) {
        p.update();
        if (p.sin < 0) p.draw();
    }

    drawBlackHole();

    // Partículas delanteras
    for (const p of particles) {
        if (p.sin >= 0) p.draw();
    }

    document.getElementById("fps").innerText = Math.round(1 / dt);
    document.getElementById("activeParticles").innerText = particles.length;

    requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
