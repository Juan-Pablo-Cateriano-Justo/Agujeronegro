<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Simulador de Agujero Negro – Kerr Relativista Pro</title>
<style>
    body { margin:0; overflow:hidden; background:#000; font-family: 'Segoe UI', sans-serif; }
    canvas { display:block; }
    #info {
        position:absolute; top:20px; left:20px;
        color:#fff; font-size:11px; letter-spacing: 1px;
        background:rgba(0,0,0,0.6);
        padding:15px; border-radius:4px;
        backdrop-filter: blur(10px);
        border-left: 3px solid #ffaa00;
        pointer-events: none;
        text-transform: uppercase;
    }
    .val { color: #ffaa00; font-weight: bold; }
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div id="info">
    <strong>Evento: Gargantúa Kerr-Style</strong><br><br>
    FPS: <span id="fps" class="val">0</span><br>
    Elementos: <span id="activeParticles" class="val">0</span><br>
    Spin (a): <span class="val">0.99</span>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

/* --- PARÁMETROS FÍSICOS --- */
const G = 1, c = 1, M = 28, a = 0.99, scale = 7;
let rs, rPlus, rISCO, centerX, centerY;

function calculateMetrics() {
    centerX = canvas.width / 2;
    centerY = canvas.height / 2;
    rs = 2 * G * M;
    rPlus = G * M * (1 + Math.sqrt(1 - a * a));
    // Simplificación de ISCO para visualización
    rISCO = rs * 3; 
}

/* --- PARTÍCULAS CON LENTE GRAVITACIONAL --- */
class Particle {
    constructor() { this.reset(); }

    reset() {
        this.r = rISCO + Math.random() * 150;
        this.theta = Math.random() * Math.PI * 2;
        this.z = (Math.random() - 0.5) * 2;
        this.size = 1 + Math.random() * 2;
        this.speed = (0.02 + Math.random() * 0.02) * Math.pow(rISCO/this.r, 1.5);
    }

    update() {
        this.theta += this.speed;
        this.r -= 0.01; // Caída lenta
        if (this.r < rPlus * 1.2) this.reset();
    }

    draw() {
        let x_raw = Math.cos(this.theta) * this.r;
        let y_raw = Math.sin(this.theta) * this.r;
        
        // Simulación de Lente Gravitacional: 
        // Si la partícula está detrás (y < 0), curvamos su luz hacia arriba/abajo
        let bending = 0;
        if (y_raw < 0) {
            bending = Math.pow(Math.abs(y_raw), 0.8) * 0.6;
        }

        const screenX = centerX + x_raw * scale;
        // El truco visual: sumamos el bending para crear el anillo superior
        const screenY = centerY + (y_raw * 0.25) * scale - (y_raw < 0 ? bending * scale : 0);

        // Color por temperatura y Doppler
        // Partículas que vienen (x > 0 en este eje) son más brillantes/azules
        const doppler = Math.sin(this.theta) > 0 ? 1.2 : 0.7;
        const distRatio = rISCO / this.r;
        
        const r = 255;
        const g = 100 + 155 * distRatio;
        const b = 50 + 200 * (1 - distRatio);

        ctx.fillStyle = `rgb(${r*doppler},${g*doppler},${b*doppler})`;
        ctx.shadowBlur = this.size * 2;
        ctx.shadowColor = `rgb(${r},${g},${b})`;
        
        ctx.beginPath();
        ctx.arc(screenX, screenY, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0; // Reset para rendimiento
    }
}

let particles = [];
for (let i = 0; i < 1200; i++) particles.push(new Particle());

function drawBackground() {
    // Gradiente sutil central
    const g = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, canvas.width/2);
    g.addColorStop(0, '#050510');
    g.addColorStop(1, '#000');
    ctx.fillStyle = g;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function drawBlackHole() {
    // El "agujero" negro central
    ctx.shadowBlur = 50;
    ctx.shadowColor = "#000";
    ctx.fillStyle = "#000";
    ctx.beginPath();
    ctx.arc(centerX, centerY, rPlus * scale * 0.9, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;
    
    // Un pequeño resplandor en el borde (Esfera de fotones)
    ctx.strokeStyle = "rgba(255,255,255,0.2)";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(centerX, centerY, rPlus * scale * 1.1, 0, Math.PI * 2);
    ctx.stroke();
}

function animate() {
    // Estela de movimiento
    ctx.fillStyle = "rgba(0, 0, 0, 0.15)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Ordenar partículas para que las de "atrás" se dibujen primero
    // (Z-buffering simple)
    particles.sort((a, b) => Math.sin(a.theta) - Math.sin(b.theta));

    particles.forEach(p => {
        p.update();
        p.draw();
    });

    drawBlackHole();

    if(Math.random() > 0.8) document.getElementById("fps").innerText = Math.round(60);
    document.getElementById("activeParticles").innerText = particles.length;

    requestAnimationFrame(animate);
}

calculateMetrics();
animate();
</script>
</body>
</html>
