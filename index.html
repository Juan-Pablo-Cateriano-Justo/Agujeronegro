<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Simulador de Agujero Negro – Gargantúa</title>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: black;
    font-family: Consolas, monospace;
}
canvas { display: block; }

#info {
    position: absolute;
    top: 20px;
    left: 20px;
    color: #fff;
    font-size: 12px;
    background: rgba(10,10,30,0.85);
    padding: 14px;
    border-left: 3px solid #ff8800;
    letter-spacing: 1px;
    text-transform: uppercase;
    box-shadow: 0 0 15px rgba(0,0,0,0.6);
    pointer-events: none;
}
.val { color: #ffae42; font-weight: bold; }
</style>
</head>

<body>
<canvas id="canvas"></canvas>

<div id="info">
<strong>Agujero Negro Kerr</strong><br><br>
FPS: <span id="fps" class="val">0</span><br>
Partículas: <span class="val">2500</span><br>
Spin (a): <span class="val">0.99</span>
</div>

<script>
/* =====================================================
   CANVAS
===================================================== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
    const dpr = window.devicePixelRatio || 1;
    canvas.width = innerWidth * dpr;
    canvas.height = innerHeight * dpr;
    canvas.style.width = innerWidth + "px";
    canvas.style.height = innerHeight + "px";
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
addEventListener("resize", resize);
resize();

/* =====================================================
   MÉTRICAS
===================================================== */
const G = 1, M = 30, a = 0.99;
const scale = 6;
let rs, rPlus, rISCO, cx, cy;

function computeMetrics() {
    cx = innerWidth / 2;
    cy = innerHeight / 2;
    rs = 2 * G * M;
    rPlus = G * M * (1 + Math.sqrt(1 - a * a));
    rISCO = rs * 2.5;
}
computeMetrics();

/* =====================================================
   ESTRELLAS
===================================================== */
const stars = Array.from({ length: 400 }, () => ({
    x: Math.random() * innerWidth,
    y: Math.random() * innerHeight,
    r: Math.random() * 1.5,
    a: 0.2 + Math.random() * 0.6
}));

function drawStars() {
    for (const s of stars) {
        ctx.globalAlpha = s.a;
        ctx.fillStyle = "#fff";
        ctx.fillRect(s.x, s.y, s.r, s.r);
    }
    ctx.globalAlpha = 1;
}

/* =====================================================
   DISCO DE ACRECIÓN
===================================================== */
class Particle {
    constructor() { this.reset(); }

    reset() {
        this.r = rISCO * 0.9 + Math.random() * rISCO * 6;
        this.theta = Math.random() * Math.PI * 2;
        this.size = 0.8 + Math.random() * 2.5;
        this.speed = (0.01 + Math.random() * 0.02) * Math.pow(rISCO / this.r, 1.7);
        this.updateTrig();
    }

    updateTrig() {
        this.sin = Math.sin(this.theta);
        this.cos = Math.cos(this.theta);
    }

    update() {
        this.theta += this.speed;
        this.r -= 0.003;
        this.updateTrig();
        if (this.r < rPlus * 0.85) this.reset();
    }

    draw() {
        const x = this.cos * this.r;
        const y = this.sin * this.r;
        const lens = (rISCO * 12) / (this.r * this.r);

        const sx = cx + x * scale;
        const sy = cy + y * 0.25 * scale - lens * scale;

        const doppler = 1 - this.sin * 0.35;

        let r = 255 * doppler;
        let g = (150 + 80 * (rISCO / this.r)) * doppler;
        let b = (80 + 40 * (rISCO / this.r)) * doppler;

        ctx.fillStyle = `rgb(${r|0},${g|0},${b|0})`;
        ctx.shadowBlur = this.size * 2;
        ctx.shadowColor = ctx.fillStyle;

        ctx.beginPath();
        ctx.arc(sx, sy, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
    }
}

const particles = [];
for (let i = 0; i < 2500; i++) {
    const p = new Particle();
    for (let j = 0; j < 30; j++) p.update();
    particles.push(p);
}

/* =====================================================
   RADIACIÓN DE HAWKING
===================================================== */
class HawkingParticle {
    constructor() { this.reset(); }

    reset() {
        this.theta = Math.random() * Math.PI * 2;
        this.r = rPlus * scale * (0.9 + Math.random() * 0.1);
        this.speed = 0.15 + Math.random() * 0.25;
        this.life = 1;
        this.size = 1 + Math.random() * 2;
    }

    update() {
        this.r += this.speed;
        this.life -= 0.01;
        if (this.life <= 0) this.reset();
    }

    draw() {
        const x = cx + Math.cos(this.theta) * this.r;
        const y = cy + Math.sin(this.theta) * this.r;

        const heat = this.life;
        const r = 255;
        const g = 160 + 80 * heat;
        const b = 80 * heat;

        ctx.fillStyle = `rgba(${r},${g|0},${b|0},${heat})`;
        ctx.shadowBlur = 15 * heat;
        ctx.shadowColor = ctx.fillStyle;

        ctx.beginPath();
        ctx.arc(x, y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
    }
}

const hawking = Array.from({ length: 120 }, () => new HawkingParticle());

/* =====================================================
   AGUJERO NEGRO
===================================================== */
function drawBlackHole() {
    const shadowR = rPlus * scale * 1.6;
    const horizonR = rPlus * scale * 0.85;

    const g = ctx.createRadialGradient(cx, cy, horizonR * 0.2, cx, cy, shadowR);
    g.addColorStop(0, "#000");
    g.addColorStop(0.7, "rgba(0,0,0,0.9)");
    g.addColorStop(1, "rgba(0,0,0,0)");

    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.arc(cx, cy, shadowR, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(cx, cy, horizonR, 0, Math.PI * 2);
    ctx.fill();
}

/* =====================================================
   LOOP
===================================================== */
let last = 0;
function animate(t) {
    const dt = (t - last) / 1000;
    last = t;

    ctx.fillStyle = "rgba(0,0,0,0.15)";
    ctx.fillRect(0, 0, innerWidth, innerHeight);

    drawStars();

    for (const p of particles) {
        p.update();
        if (p.sin < 0) p.draw();
    }

    for (const h of hawking) {
        h.update();
        h.draw();
    }

    drawBlackHole();

    for (const p of particles) {
        if (p.sin >= 0) p.draw();
    }

    document.getElementById("fps").innerText = Math.round(1 / dt);
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
